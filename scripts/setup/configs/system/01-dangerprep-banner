#!/bin/bash
# DangerPrep MOTD Banner
# Displays the DangerPrep banner on login using fastfetch

# Check if fastfetch is available and configuration exists
FASTFETCH_CONFIG="/opt/dangerprep/fastfetch-dangerprep.jsonc"

if command -v fastfetch >/dev/null 2>&1 && [[ -f "$FASTFETCH_CONFIG" ]]; then
    # Use fastfetch with DangerPrep configuration
    fastfetch --config "$FASTFETCH_CONFIG"
else
    # Fallback to simple banner if fastfetch is not available
    echo "DangerPrep Emergency Router System"
    echo "=================================="
    echo
    echo "Welcome to DangerPrep Emergency Router System"
    echo "System Status: https://portal.danger"
    echo "Documentation: https://github.com/vladzaharia/dangerprep"
    echo

    # Show basic system info as fallback
    echo "System Information:"
    echo "  Hostname: $(hostname)"
    echo "  Uptime: $(uptime -p 2>/dev/null || uptime)"
    echo "  Load: $(uptime | awk -F'load average:' '{print $2}' 2>/dev/null || echo 'N/A')"
    echo "  Memory: $(free -h 2>/dev/null | awk '/^Mem:/ {print $3 "/" $2}' || echo 'N/A')"
    echo "  Disk: $(df -h / 2>/dev/null | awk 'NR==2 {print $3 "/" $2 " (" $5 " used)"}' || echo 'N/A')"
    echo

    # Show network status if available
    if command -v ip >/dev/null 2>&1; then
        echo "Network Interfaces:"
        ip -br addr show 2>/dev/null | grep -E "(UP|UNKNOWN)" | while read -r line; do
            echo "  $line"
        done 2>/dev/null || echo "  Network information unavailable"
        echo
    fi

    # Show Docker status if available
    if command -v docker >/dev/null 2>&1 && systemctl is-active --quiet docker 2>/dev/null; then
        echo "Docker Services:"
        docker ps --format "table {{.Names}}\t{{.Status}}" 2>/dev/null | head -6 || echo "  Docker information unavailable"
        echo
    fi
fi
