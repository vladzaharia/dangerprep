# DangerPrep Advanced DNS Configuration with DNSSEC

# Interface binding
interface={{WIFI_INTERFACE}}
bind-interfaces
listen-address={{LAN_IP}}

# DHCP configuration
dhcp-range={{DHCP_START}},{{DHCP_END}},12h
dhcp-option=3,{{LAN_IP}}  # Default gateway
dhcp-option=6,{{LAN_IP}}  # DNS server

# DNS configuration - Use unbound for DNSSEC validation
no-resolv
server=127.0.0.1#5054  # unbound with DNSSEC
server=127.0.0.1#5053  # cloudflared DoH (fallback)

# DNSSEC settings
dnssec
trust-anchor=.,20326,8,2,E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D
dnssec-check-unsigned

# Cache settings
cache-size=2000
neg-ttl=60
dns-forward-max=300

# Local domain resolution (.danger domains)
local=/danger/
domain=danger
expand-hosts
address=/adguard.danger/{{LAN_IP}}
address=/step-ca.danger/{{LAN_IP}}
address=/kiwix.danger/{{LAN_IP}}
address=/portal.danger/{{LAN_IP}}
address=/dns.danger/{{LAN_IP}}
address=/router.danger/{{LAN_IP}}

# Tailscale DNS integration
server=100.100.100.100  # Tailscale DNS

# Security settings
bogus-priv
domain-needed
stop-dns-rebind
rebind-localhost-ok

# Ad blocking - common ad domains
address=/doubleclick.net/0.0.0.0
address=/googleadservices.com/0.0.0.0
address=/googlesyndication.com/0.0.0.0
address=/facebook.com/0.0.0.0
address=/fbcdn.net/0.0.0.0
address=/google-analytics.com/0.0.0.0
address=/googletagmanager.com/0.0.0.0

# Performance settings
dns-forward-max=150
cache-size=2000

# Logging (disable in production for performance)
log-queries
log-facility=/var/log/dnsmasq.log
