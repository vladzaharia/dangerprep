# CoreDNS configuration for local domain resolution
# This file is managed by the dns-registrar service

# Local domain resolution - Internal (.danger)
danger {
    file /etc/coredns/db.danger
    log
    errors
}

# Local domain resolution - External (.danger.diy)
danger.diy {
    file /etc/coredns/db.danger.diy
    log
    errors
}

# Fallback to upstream DNS (NextDNS directly)
# Using NextDNS endpoints for secure DNS resolution with redundancy
. {
    # Forward to NextDNS servers (using standard DNS, not DoT for simplicity)
    forward . 45.90.28.0 45.90.30.0 {
        except danger danger.diy
    }

    log
    errors
    cache 300  # 5 minutes cache for better performance
    reload

    # Enable DNSSEC validation
    dnssec
}
